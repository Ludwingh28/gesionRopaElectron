# ğŸ“‹ Sistema de Inventario de Ropa - DocumentaciÃ³n Completa

## ğŸ¯ Cumplimiento de Requerimientos

### âœ… Formas Normales (1FN, 2FN, 3FN)

**Primera Forma Normal (1FN):**
- âœ… Cada celda contiene un valor Ãºnico
- âœ… No hay grupos repetidos
- âœ… Cada fila es Ãºnica mediante claves primarias

**Segunda Forma Normal (2FN):**
- âœ… Cumple 1FN
- âœ… Todos los atributos no clave dependen completamente de la clave primaria
- âœ… Eliminadas dependencias parciales mediante separaciÃ³n en tablas especializadas

**Tercera Forma Normal (3FN):**
- âœ… Cumple 2FN  
- âœ… No hay dependencias transitivas
- âœ… Cada atributo no clave depende Ãºnicamente de la clave primaria

### ğŸ” Sistema de Usuarios y Roles

- **Roles implementados:**
  - `developer`: Acceso completo al sistema
  - `admin`: GestiÃ³n y ventas
  - `promotora`: Ventas con precio especial (+20%)

### ğŸ·ï¸ GeneraciÃ³n de CÃ³digos

- **IDs automÃ¡ticos:** 
  - **Productos, SKUs y Ventas:** Comienzan en 1000
  - **Usuarios:** Comienzan en 1 (secuencia normal)
- **CÃ³digos generados:**
  - Productos: `PROD-001000`, `PROD-001001`, etc.
  - SKUs: `PROD-001000-38-AZU` (Producto-Talla-Color)
  - Ventas: `VTA-20250714-1000` (Fecha-Correlativo)
  - Usuarios: 1, 2, 3, etc.

### ğŸ’° Sistema de Precios

- **Precio base:** Para admin y otros roles
- **Precio promotora:** AutomÃ¡ticamente +20% del precio base
- **CÃ¡lculo:** Campo calculado `precio_promotora DECIMAL(10,2) AS (precio_venta_base * 1.20) STORED`

## ğŸ—„ï¸ Estructura de la Base de Datos

### Tablas Principales

#### ğŸ‘¥ usuarios
```sql
- id (PK, AUTO_INCREMENT desde 1)
- nombre, email, password_hash
- rol_id (FK a roles)
- activo, created_at, updated_at
```

#### ğŸ­ roles  
```sql
- id (PK)
- nombre (developer/admin/promotora)
- descripcion
```

#### ğŸ“¦ productos
```sql
- id (PK, AUTO_INCREMENT desde 1000)
- codigo_interno (generado automÃ¡ticamente)
- detalle, marca_id, categoria_id
- costo_compra, precio_venta_base
- precio_promotora (calculado automÃ¡ticamente)
```

#### ğŸ“‹ inventario
```sql
- id (PK, AUTO_INCREMENT desde 1000)
- sku (generado automÃ¡ticamente)
- producto_id, talla_id, color_id
- stock_actual, stock_minimo
- UNIQUE(producto_id, talla_id, color_id)
```

#### ğŸ›’ ventas
```sql
- id (PK, AUTO_INCREMENT desde 1000)
- numero_venta (generado automÃ¡ticamente)
- usuario_id, cliente_info
- totales calculados automÃ¡ticamente
```

#### ğŸ“„ detalle_ventas
```sql
- venta_id, inventario_id
- cantidad, precio_unitario
- subtotal (calculado automÃ¡ticamente)
```

### Tablas de Soporte
- **marcas**: CatÃ¡logo de marcas
- **colores**: CatÃ¡logo de colores  
- **categorias**: Tipos de productos
- **tallas**: CatÃ¡logo de tallas
- **movimientos_inventario**: Trazabilidad completa

## ğŸ”§ Triggers Implementados

### `tr_producto_codigo_interno`
**Tipo:** AFTER INSERT  
Genera automÃ¡ticamente cÃ³digos de productos: `PROD-001000` despuÃ©s de la inserciÃ³n

### `tr_inventario_sku`
**Tipo:** AFTER INSERT  
Genera SKUs Ãºnicos: `PROD-001000-38-AZU` despuÃ©s de la inserciÃ³n

### `tr_venta_numero`
**Tipo:** AFTER INSERT  
Genera nÃºmeros de venta: `VTA-20250714-1000` despuÃ©s de la inserciÃ³n

### `tr_actualizar_stock_venta`
**Tipo:** AFTER INSERT en detalle_ventas  
- Actualiza stock automÃ¡ticamente en ventas
- Registra movimientos de inventario
- Mantiene trazabilidad completa

### `tr_calcular_total_venta`
**Tipo:** AFTER INSERT en detalle_ventas  
Calcula totales de ventas automÃ¡ticamente

## ğŸ“Š Procedimientos Almacenados

### `sp_realizar_venta()`
```sql
CALL sp_realizar_venta(
    usuario_id,
    cliente_nombre,
    cliente_documento, 
    metodo_pago,
    observaciones,
    OUT venta_id,
    OUT mensaje
);
```

### `sp_agregar_articulo_venta()`
```sql
CALL sp_agregar_articulo_venta(
    venta_id,
    inventario_id,
    cantidad,
    OUT mensaje
);
```

### `sp_reporte_ventas_promotora()`
```sql
CALL sp_reporte_ventas_promotora('2025-01-01', '2025-12-31');
```
**Retorna:** Ranking de promotoras por ventas totales

### `sp_reporte_productos_mas_vendidos()`
```sql
CALL sp_reporte_productos_mas_vendidos('2025-01-01', '2025-12-31', 20);
```
**Retorna:** Top productos mÃ¡s vendidos  
**Nota:** Usa PREPARE STATEMENT para manejar el parÃ¡metro LIMIT dinÃ¡micamente

### `sp_productos_stock_bajo()`
```sql
CALL sp_productos_stock_bajo();
```
**Retorna:** Productos que necesitan reposiciÃ³n

## ğŸ‘ï¸ Vistas Principales

### `v_inventario_completo`
Vista consolidada con toda la informaciÃ³n de inventario:
- SKU, cÃ³digo, descripciÃ³n completa
- Marca, categorÃ­a, talla, color
- Stock actual, mÃ­nimo, estado
- Precios base y promotora

### `v_ventas_detalle`
Vista completa de ventas con informaciÃ³n detallada:
- Datos de venta y vendedor
- InformaciÃ³n completa del producto
- Cantidades y precios aplicados

## ğŸ“ˆ Reportes Disponibles

### 1. Ranking de Promotoras
```sql
SELECT * FROM v_ventas_detalle 
WHERE rol_vendedor = 'promotora'
GROUP BY vendedor
ORDER BY SUM(subtotal) DESC;
```

### 2. Productos MÃ¡s Vendidos
```sql
CALL sp_reporte_productos_mas_vendidos(fecha_inicio, fecha_fin, limite);
```

### 3. AnÃ¡lisis por Marca
```sql
SELECT marca, COUNT(*) as productos, SUM(stock_actual) as stock_total
FROM v_inventario_completo
GROUP BY marca
ORDER BY stock_total DESC;
```

### 4. Control de Stock
```sql
CALL sp_productos_stock_bajo();
```

## ğŸš€ Ejemplos de Uso

### Realizar una Venta (Promotora)
```sql
-- 1. Crear venta
CALL sp_realizar_venta(
    1001, -- ID promotora MarÃ­a
    'Cliente Ejemplo',
    '12345678',
    'efectivo',
    'Venta normal',
    @venta_id,
    @mensaje
);

-- 2. Agregar productos (automÃ¡ticamente aplica precio promotora +20%)
CALL sp_agregar_articulo_venta(@venta_id, 1000, 2, @msg);
CALL sp_agregar_articulo_venta(@venta_id, 1001, 1, @msg);
```

### Consultar Inventario con Stock Bajo
```sql
SELECT sku, detalle, marca, talla, color, stock_actual, stock_minimo
FROM v_inventario_completo 
WHERE estado_stock IN ('SIN STOCK', 'STOCK BAJO')
ORDER BY stock_actual ASC;
```

### Reporte de Ventas del Mes
```sql
CALL sp_reporte_ventas_promotora(
    DATE_FORMAT(NOW(), '%Y-%m-01'),
    LAST_DAY(NOW())
);
```

## ğŸ” CaracterÃ­sticas de Seguridad

### Integridad Referencial
- Todas las FK con `ON DELETE RESTRICT` para datos crÃ­ticos
- `ON DELETE CASCADE` solo en detalles de venta
- Constraints Ãºnicos en campos crÃ­ticos

### Validaciones AutomÃ¡ticas
- Stock no puede ser negativo (triggers)
- FunciÃ³n `fn_verificar_stock_negativo()` para auditorÃ­as
- Usuarios deben tener rol vÃ¡lido para vender

### Trazabilidad Completa
- Tabla `movimientos_inventario` registra todos los cambios
- Timestamps automÃ¡ticos en todas las tablas
- RelaciÃ³n entre movimientos y ventas

## ğŸ”§ Mantenimiento

### Limpieza AutomÃ¡tica
```sql
-- Evento que ejecuta cada mes
CREATE EVENT ev_limpieza_logs
ON SCHEDULE EVERY 1 MONTH
-- Elimina movimientos de inventario > 1 aÃ±o
```

### Verificaciones de Integridad
```sql
SELECT fn_verificar_stock_negativo(); -- Verifica stocks
```

### Ãndices Optimizados
- Ãndices en campos de bÃºsqueda frecuente
- Ãndices compuestos para consultas complejas
- Ãndices en fechas para reportes

## ğŸ“Š MÃ©tricas del Sistema

**Tablas creadas:** 11 principales + soporte  
**Triggers:** 5 automÃ¡ticos  
**Procedimientos:** 4 especializados  
**Vistas:** 2 principales  
**Ãndices:** 15+ optimizados  
**Eventos:** 1 de mantenimiento  

## ğŸ¯ Beneficios Implementados

âœ… **Alta Fidelidad:** Replica exactamente el inventario original  
âœ… **NormalizaciÃ³n Completa:** 1FN, 2FN, 3FN estrictamente cumplidas  
âœ… **AutomatizaciÃ³n Total:** Triggers manejan toda la lÃ³gica de negocio  
âœ… **Reportes Integrados:** Procedimientos listos para usar  
âœ… **Escalabilidad:** DiseÃ±o preparado para crecimiento  
âœ… **Seguridad:** Roles, validaciones y restricciones  
âœ… **Mantenimiento:** Limpieza automÃ¡tica y verificaciones  

## ğŸ“ Soporte

Para consultas sobre implementaciÃ³n o extensiones del sistema, consultar la documentaciÃ³n tÃ©cnica en los comentarios del cÃ³digo SQL.